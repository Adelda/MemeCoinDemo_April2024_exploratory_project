<!DOCTYPE html>
<html lang="fr" translate="no">
<head>
  <meta charset="utf-8" />
  <title>FCM Test</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>
<body>
  <h1>Test FCM Notifications</h1>
  <button id="requestPermission">Request Notification Permission</button>
  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-analytics.js";
    import { getMessaging, getToken, onMessage } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-messaging.js";

    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyA6aYOgAscSQe4W0WJgB9Ha0X21WMbyBCw",
      authDomain: "test-4dd75.firebaseapp.com",
      projectId: "test-4dd75",
      storageBucket: "test-4dd75.appspot.com",
      messagingSenderId: "713610534619",
      appId: "1:713610534619:web:73a87ecd45a68fc608f6fe",
      measurementId: "G-517JXC2V10"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);

    // Initialize Firebase Cloud Messaging and get a reference to the service
    const messaging = getMessaging(app);

    document.getElementById('requestPermission').onclick = async function() {
      try {
        const permission = await Notification.requestPermission();
        if (permission === 'granted') {
          console.log('Notification permission granted.');
          const token = await getToken(messaging, { vapidKey: 'BAszWP3EcR1Fye0enGdosgCyAAo1CskXCq4cEWBX97FkF44vmjL-2ojMYMASpUr5fzUchIhI-TgXnCNr7Q3GI6s' });
          console.log('FCM Registration Token:', token);
          alert('FCM Registration Token: ' + token);
          // Copy the token and use it to send test notifications from Firebase Console
        } else {
          console.error('Unable to get permission to notify.');
        }
      } catch (err) {
        console.error('Error occurred while requesting permission or getting token:', err);
      }
    };

    onMessage(messaging, (payload) => {
      console.log('Message received. ', payload);
      alert('Message received: ' + JSON.stringify(payload));
    });
  </script>
</body>
</html>
